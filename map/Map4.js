import Map from "../MapHandler.js";
import Enemy from "../Enemy.js";
import ObstacleCollision from "../ObstaclesCollision.js";
import Bloodsplosion from "../Bloodsplosion.js";

export default class Map4 {
  constructor(ctx) {
    this.ctx = ctx; // sSpeichern Sie den ctx-Parameter in der Instanz
    this.zombieCount = 0;
    this.bossCount = 1;
    this.shootTimer = 0;
    this.boss = new Enemy(900, 300, 120, 120, 0);
    this.boss.aggroRange = 1000;
    this.boss.speed = 3;

    this.map = [
      29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29,
      29, 29, 29, 29, 29, 29, 29, 29, 259, 67, 225, 6, 225, 225, 225, 263, 44,
      6, 44, 44, 44, 263, 6, 44, 144, 44, 225, 263, 225, 6, 44, 225, 44, 44, 44,
      105, 67, 6, 6, 225, 263, 263, 30, 225, 44, 225, 225, 85, 6, 6, 225, 6,
      225, 263, 6, 6, 68, 85, 263, 263, 6, 263, 105, 67, 263, 44, 6, 263, 44,
      225, 6, 44, 263, 225, 263, 44, 44, 225, 263, 263, 44, 6, 225, 44, 263, 6,
      263, 44, 6, 105, 67, 253, 225, 85, 44, 6, 263, 175, 6, 44, 263, 263, 225,
      225, 225, 44, 263, 6, 263, 44, 6, 225, 263, 85, 263, 44, 105, 6, 6, 225,
      6, 225, 44, 263, 6, 225, 263, 225, 263, 144, 263, 6, 263, 179, 225, 225,
      6, 6, 44, 6, 6, 225, 225, 105, 40, 180, 44, 6, 44, 263, 225, 44, 6, 263,
      44, 225, 263, 6, 263, 263, 225, 225, 44, 263, 107, 44, 44, 225, 225, 225,
      105, 67, 263, 6, 30, 263, 225, 144, 6, 44, 6, 263, 225, 225, 263, 263,
      263, 263, 225, 225, 263, 44, 225, 44, 6, 263, 263, 105, 67, 44, 44, 225,
      44, 44, 263, 6, 44, 263, 44, 225, 263, 263, 263, 6, 263, 6, 225, 225, 263,
      6, 6, 44, 6, 263, 105, 67, 106, 263, 263, 44, 6, 44, 225, 6, 68, 85, 6,
      263, 6, 225, 263, 263, 44, 225, 6, 225, 6, 225, 44, 225, 225, 105, 67,
      263, 225, 225, 6, 263, 44, 6, 225, 225, 225, 225, 263, 44, 175, 44, 144,
      6, 6, 85, 225, 225, 85, 180, 225, 6, 105, 67, 263, 263, 6, 144, 44, 263,
      263, 6, 6, 6, 225, 44, 6, 44, 44, 263, 44, 263, 6, 225, 263, 44, 263, 44,
      225, 105, 143, 143, 143, 143, 143, 143, 143, 143, 143, 143, 143, 143, 143,
      143, 143, 143, 143, 143, 143, 143, 143, 143, 143, 143, 143, 143, 105,
    ];
    this.overlay = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0,
      0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 9, 0, 8, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0,
      0, 0, 0, 0, 47, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0,
      0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      9, 0, 0, 0, 8, 0, 0, 0, 8, 9, 8, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 47, 0, 0, 0, 0, 0, 0, 0, 8, 7, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 47, 0, 0, 9, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0,
    ];
    // console.log(this.map[1].length);
    this.mapInstance = new Map(ctx, this.map, this.mapDefinition);
  }

  bossHandler(
    ctx,
    deltaTime,
    player,
    obstacleCollision,
    bullets,
    bloodsplosions
  ) {
    this.boss.update(
      player.x,
      player.y,
      deltaTime,
      0,
      0,
      obstacleCollision,
      player
    );

    //bulletCollision
    for (let i = 0; i < bullets.length; i++) {
      let hitIndex = undefined;
      hitIndex = bullets[i].collisionEnemy(
        [this.boss],
        deltaTime,
        0,
        0,
        obstacleCollision
      );
      console.log(hitIndex);
      if (hitIndex === 0) {
        bloodsplosions.push(
          new Bloodsplosion(
            bullets[i].x,
            bullets[i].y,
            bullets[i].vx,
            bullets[i].vy
          )
        );
        console.log(bloodsplosions);
        bullets.splice(i, 1);
        i--;
      }
    }

    this.boss.draw(ctx, deltaTime, 0, 0, player.x, player.y);
    this.shootTimer++;
  }
}
